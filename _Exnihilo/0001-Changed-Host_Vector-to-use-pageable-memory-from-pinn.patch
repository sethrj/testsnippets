From 0ff89ebae879b244b5e19b86946347aa46b64a62 Mon Sep 17 00:00:00 2001
From: Seth R Johnson <johnsonsr@ornl.gov>
Date: Sat, 17 Aug 2013 17:09:59 -0400
Subject: [PATCH] Changed Host_Vector to use pageable memory from pinned

This is temporary and just for testing purposes.
---
 packages/Transcore/cuda_utils/Host_Vector.t.hh | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/packages/Transcore/cuda_utils/Host_Vector.t.hh b/packages/Transcore/cuda_utils/Host_Vector.t.hh
index d8abb94..3caf2ed 100644
--- a/packages/Transcore/cuda_utils/Host_Vector.t.hh
+++ b/packages/Transcore/cuda_utils/Host_Vector.t.hh
@@ -60,7 +60,10 @@ Host_Vector<T>::Host_Vector(
             break;
     }
 
-    CudaCall(cudaHostAlloc(&d_begin, count * sizeof(T), cuda_flags));
+    if (d_alloc_flag == alloc::DEFAULT)
+        d_begin = reinterpret_cast<T*>(std::calloc(count, sizeof(T)));
+    else
+        CudaCall(cudaHostAlloc(&d_begin, count * sizeof(T), cuda_flags));
 #else // CUDA is disabled in this build
     d_begin = reinterpret_cast<T*>(std::calloc(count, sizeof(T)));
 #endif // USE_CUDA
@@ -94,6 +97,9 @@ Host_Vector<T>::~Host_Vector()
     try
     {
 #ifdef USE_CUDA
+    if (d_alloc_flag == alloc::DEFAULT)
+        std::free(d_begin);
+    else
         CudaCall(cudaFreeHost(d_begin));
 #else
         std::free(d_begin);
-- 
1.8.3.4

